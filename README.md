# Telegram-бот для прогнозирования цен акций

Учебный проект: загружает исторические котировки, обучает модели и возвращает прогноз цены акций на 30 дней с простой торговой рекомендацией.

## Требования

- Python 3.9+
- Интернет (для загрузки данных через Yahoo Finance)
- Токен Telegram-бота (получить у [BotFather](https://t.me/BotFather))

## Функциональность

- Ввод тикера и суммы для условной инвестиции
- Автоматический выбор лучшей модели (RandomForest / Prophet / LSTM) по метрике MAPE
- Построение графика с историей и прогнозом
- Простая торговая стратегия и расчёт ожидаемой прибыли
- Логирование запросов в `logs/logs.csv`

## Структура проекта

```
stock_forecast_bot/
├── run.py                # Точка входа: python run.py
├── .env.example          # Пример конфигурации
├── requirements.txt      # Зависимости
├── README.md             # Этот файл
│
├── bot/                  # Логика Telegram-бота
│   ├── __init__.py
│   └── app.py            # Обработчики команд и сообщений
│
├── data/                 # Загрузка и обработка данных
│   ├── __init__.py
│   └── loader.py         # Загрузка котировок с Yahoo Finance
│
├── models/               # Модели прогнозирования
│   ├── __init__.py
│   ├── lstm.py           # LSTM нейросеть (LSTMModel)
│   ├── random_forest.py  # Random Forest с лагами (RandomForestModel)
│   ├── prophet.py        # Prophet от Meta (ProphetModel)
│   └── model_selector.py # Выбор лучшей модели по MAPE
│
├── utils/                # Вспомогательные утилиты
│   ├── __init__.py
│   ├── logger.py         # Логирование в logs/logs.csv
│   ├── plotting.py       # Построение графиков (plot_forecast)
│   └── trading.py        # Торговая стратегия (calculate_profit, find_trading_signals)
│
├── logs/                 # Логи приложения (создаётся автоматически)
│   ├── __init__.py
│   └── logs.csv          # Записи запросов пользователей
│
└── tests/                # Интеграционные тесты
    ├── __init__.py
    ├── test_yf.py        # Тест загрузки данных
    ├── test_lstm.py      # Тест LSTM модели
    ├── test_prophet.py   # Тест Prophet модели
    ├── test_rf.py        # Тест Random Forest модели
    ├── test_selector.py  # Тест выбора моделей
    ├── test_strategy.py  # Тест торговой стратегии
    └── test_plot.py      # Тест графиков
```

## Установка и запуск

### 1. Клонируйте или создайте папку проекта

```bash
git clone <repo_url>
cd stock_forecast_bot
```

### 2. Создайте и активируйте виртуальное окружение

```bash
python -m venv venv
source venv/bin/activate        # Linux / macOS
# или
venv\Scripts\activate           # Windows
```

### 3. Установите зависимости

```bash
pip install -r requirements.txt
```

### 4. Настройте Telegram-бота

Скопируйте `.env.example` в `.env`:

```bash
cp .env.example .env
```

Отредактируйте `.env` и вставьте ваш токен:

```env
BOT_TOKEN=123456789:ABCdefGhIJKlmNoPQRsTUVwxyZ
```

### 5. Запустите бота

```bash
python run.py
```

## Использование в Telegram

1. Найдите своего бота по имени
2. Отправьте `/start`
3. Введите тикер (например: `AAPL`, `MSFT`, `TSLA`)
4. Введите сумму инвестиции в USD (например: `1000`)
5. Получите:
   - График с историей цен (90 дней) и прогнозом (30 дней)
   - Прогноз цены акции
   - Торговые рекомендации (точки покупки/продажи)
   - Расчёт ожидаемой прибыли

## Модели прогнозирования

Бот обучает три модели и выбирает лучшую по метрике **MAPE** (Mean Absolute Percentage Error):

- **RandomForest** — модель с 10 лаговыми признаками, 100 деревьев
- **Prophet** — статистическая модель Meta с учётом сезонности (годовой и недельной)
- **LSTM** — нейросеть на основе долгой краткосрочной памяти, 2 слоя с дропаутом

## Примечания

- **Учебный проект** — не использовать как финансовую рекомендацию
- **Бот не совершает реальные сделки** — только анализирует и рекомендует
- **Прогнозы основаны на исторических данных** и могут быть неточными
- Реальное качество зависит от волатильности и стабильности рынка